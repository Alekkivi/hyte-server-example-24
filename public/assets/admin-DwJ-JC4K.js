import"./universal-styles-Dbk1WByh.js";import{i as b,j as S,l as T,k as I,h as g,d as x,c as _}from"./log-out-BDTD2EQk.js";import{g as f,s as l}from"./fetch-qW78LKou.js";document.addEventListener("DOMContentLoaded",async()=>{try{const e=await f("/api/auth/me"),t=localStorage.getItem("token");if(e.error==="invalid token"||e.user.user_level!=="admin"||!t)throw new Error("Unauthorized");document.getElementById("name").innerHTML=e.user.username,localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username)}catch{window.location.href="index.html"}});const U=document.querySelector(".get_users");U.addEventListener("click",k);const v=document.querySelector("#hide_all_entries");v.addEventListener("click",b);v.style.display="none";const L=document.querySelector("#hide_all_users");L.addEventListener("click",S);L.style.display="none";const q=document.querySelector(".navigation a");q.addEventListener("click",T);async function k(){const e=await f("/api/users");Object.keys(e).length>0?e.error?l("Crimson",e.message):(document.querySelector("#hide_all_users").style.display="inline",w(e)):l("Crimson","No users found")}async function D(e){const t=e.target.getAttribute("data-id");document.querySelector("#entry_target").innerHTML="";const r=await f(`/api/entries/${t}`);r.error?l("crimson",`No entries found with User ID = ${t}`):(console.log("getUserEntries",r),A(r))}async function $(e){const t=e.target.attributes["data-id"].value,r=localStorage.getItem("user_id");if(t==r){l("crimson","You cant delete your own account");return}else if(confirm(`Oletko varma ett채 haluat poistaa k채ytt채j채n ID: ${t} `)){g(`/api/exercises/${t}`),g(`/api/entries/${t}`);const o=await g(`/api/users/${t}`);o.error?l("crimson",o.message):k()}}function w(e){const t=document.querySelector(".styled-table"),r=t.querySelector("thead"),d=t.querySelector("tbody");r.innerHTML="",d.innerHTML="";const o=document.createElement("tr");["User Name","User Level","Info","Delete","User ID","Entries"].forEach(s=>{const n=document.createElement("th");n.textContent=s,o.appendChild(n)}),r.appendChild(o),e.forEach(s=>{const n=document.createElement("tr"),m=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),E=document.createElement("td"),C=document.createElement("td"),y=document.createElement("td");m.innerText=s.username,p.innerText=s.user_level,C.innerText=s.user_id;const a=document.createElement("button");a.className="check",a.setAttribute("data-id",s.user_id),a.innerText="Info",h.appendChild(a);const c=document.createElement("button");c.className="del",c.setAttribute("data-id",s.user_id),c.innerText="Delete",E.appendChild(c);const i=document.createElement("button");i.className="check",i.setAttribute("data-id",s.user_id),i.innerText="Get all entries",y.appendChild(i),a.addEventListener("click",I),i.addEventListener("click",D),c.addEventListener("click",$),n.appendChild(m),n.appendChild(p),n.appendChild(h),n.appendChild(E),n.appendChild(C),n.appendChild(y),d.appendChild(n)})}async function A(e){const t=Object.keys(e).length;if(t===0){l("crimson","No entries found");return}else{l("darkgreen",`${t} entries found`),document.querySelector("#hide_all_entries").style.display="inline";const r=document.querySelector("#entry_target");r.innerHTML="",e.forEach(d=>{r.appendChild(N(d))})}}function N(e){const t=document.createElement("div");t.classList.add("card"),t.id=e.entry_id;const r=e.entry_id,d=document.createElement("div");d.classList.add("mood-colour"),d.id="trigger",d.style.backgroundColor=e.mood_color;const o=document.createElement("div");o.classList.add("entry-options");const u=document.createElement("button");u.innerHTML="X",u.classList.add("delete-button"),u.setAttribute("data-id",r),u.addEventListener("click",function(i){x(i,r)});const s=document.createElement("h4");s.textContent=_(e.entry_date);const n=document.createElement("div");n.classList.add("card-diary");const m=document.createElement("p");m.textContent=`User ID: ${e.user_id}`;const p=document.createElement("p");p.textContent=`Entry ID: ${e.entry_id}`;const h=document.createElement("p");h.textContent=`Created at: ${_(e.entry_date)}`;const E=document.createElement("p");E.textContent=`Weight: ${e.weight}`;const C=document.createElement("p");C.textContent=`Sleep hours: ${e.sleep_hours}`;const y=document.createElement("h5");y.textContent="Notes";const a=document.createElement("div"),c=document.createElement("p");return a.classList.add("card-notes-section"),c.textContent=e.notes,a.appendChild(c),o.appendChild(u),d.appendChild(s),d.appendChild(o),n.appendChild(m),n.appendChild(p),n.appendChild(h),n.appendChild(E),n.appendChild(C),n.appendChild(y),n.appendChild(a),t.appendChild(d),t.appendChild(n),t}
