import"./modulepreload-polyfill-B5Qt9EMX.js";import{g as S,f as b}from"./fetch-DJ5P6f8c.js";import{s as y}from"./snackbar-BNtgsuzo.js";document.addEventListener("DOMContentLoaded",async()=>{try{const e=await S("http://127.0.0.1:3000/api/auth/me"),o=localStorage.getItem("token");if(e.error==="invalid token"||!o)throw new Error("Unauthorized");console.log("Page reload getMe",e),localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username),document.querySelector("#greeting-header").innerHTML=`Welcome back ${e.user.username}!`,document.querySelector("#date-header").innerHTML=C(k())}catch(e){console.error("Error:",e.message),window.location.href="home.html"}});const I=document.querySelector("#get_all_entries");I.addEventListener("click",w);const f=document.querySelector("#hide_all_entries");f.style.display="none";f.addEventListener("click",R);const B=document.querySelector("#get_all_exercises");B.addEventListener("click",M);const L=document.querySelector("#hide_all_exercises");L.style.display="none";L.addEventListener("click",K);const q=document.querySelector("#log-out");q.addEventListener("click",Q);async function M(){const e=await S("http://127.0.0.1:3000/api/exercises");Object.keys(e).length>0?(document.querySelector("#hide_all_exercises").style.display="inline",O(e)):y("crimson","No exercises found")}const N=document.querySelector("#entry_form");N.addEventListener("submit",e=>{e.preventDefault(),_()});function _(){console.log("Entry form submitted!");const e=document.getElementById("mood").value,o=document.getElementById("weight").value,r=document.getElementById("sleep").value,n=document.getElementById("notes").value,t={mood_color:e,weight:o,notes:n,sleep_hours:r,user_id:localStorage.getItem("user_id"),entry_date:k()};console.log("Entry form submitted with:",t),z(t)}const H=document.querySelector("#exercise-form");function $(e){console.log("Delete pressed");const o=e.target.attributes["data-id"].value;console.log(e);const r={exercise_id:o};console.log(r);const n="http://127.0.0.1:3000/api/exercises",c={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(r)};console.log(c),confirm("Oletko varma ettÃ¤ haluat poistaa aktiviteetin?")&&b(n,c).then(s=>{console.log(s),y("darkgreen","Exercise deleted"),document.querySelector(`#exercise_id\\=${o}`).innerHTML=""})}function O(e){const o=document.querySelector(".tbody");o.innerHTML="",console.log("createExerciseTable",e);const r={};e.forEach(n=>{const t=n.activity.toLowerCase(),c=n.duration;r[t]?r[t]+=c:r[t]=c;const i=document.createElement("tr");i.id=`exercise_id=${n.exercise_id}`;const s=document.createElement("td"),a=document.createElement("td"),l=document.createElement("td"),d=document.createElement("td"),m=document.createElement("td");s.innerText=n.activity,a.innerText=n.intensity,l.innerText=n.duration,d.innerText=C(A(n.entry_date));const u=document.createElement("button");u.className="del",u.setAttribute("data-id",n.exercise_id),u.innerText="Delete",m.appendChild(u),u.addEventListener("click",$),i.appendChild(s),i.appendChild(a),i.appendChild(l),i.appendChild(d),i.appendChild(m),o.appendChild(i)}),F(r)}function F(e){console.log(e);const o=document.querySelector(".exercise-stats-target");o.innerHTML="";const r=document.createElement("h3");r.innerHTML="Total time spent on unique activities:",o.appendChild(r);for(const n in e)if(e.hasOwnProperty(n)){const t=e[n],c=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),i=document.createElement("p");i.innerHTML=`<span>${c} </span> - ${t} minutes`,o.appendChild(i)}}H.addEventListener("submit",e=>{e.preventDefault(),console.log("Exercise form submitted!");const o=document.getElementById("activity").value,r=document.getElementById("duration").value,n=document.getElementById("intensity").value,t={activity:o,duration:r,intensity:n,user_id:localStorage.getItem("user_id"),entry_date:k()};console.log("Exercise form submitted with:",t),P(t)});async function P(e){const o="http://127.0.0.1:3000/api/exercises",n={method:"POST",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(e)};b(o,n).then(t=>{t.error?y("crimson","New exercise couldn't be added!"):(console.log(t),y("darkgreen","New exercise added!"))})}async function z(e){const o="http://127.0.0.1:3000/api/entries",n={method:"POST",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(e)};b(o,n).then(t=>{t.error?y("crimson","New entry couldn't be added!"):(console.log(t),y("darkgreen","New entry added!"))})}async function U(e){const o="http://127.0.0.1:3000/api/entries",n={method:"PUT",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(e)};b(o,n).then(t=>{t.error?y("crimson","Couldn't update entry!"):(console.log(t),y("darkgreen","Entry updated!"),w())})}async function w(){const e=await S("http://127.0.0.1:3000/api/entries");f.style.display="inline";const o=Object.keys(e).length;if(!o>0)return console.log("No entries found"),y("crimson","No entries found");console.log(o,"Entries found");const r=document.querySelector(".right-diary");r.innerHTML="",e.forEach(n=>{r.appendChild(j(n))})}function j(e){const o=document.createElement("div");o.classList.add("card"),o.id=e.entry_id;const r=e.entry_id,n=e.mood_color,t=e.weight,c=e.notes,i=e.sleep_hours,s=A(e.entry_date),a=document.createElement("div");a.classList.add("mood-colour"),a.id="trigger";try{a.style.backgroundColor=n}catch{console.log("Incorrect entry mood color"),a.style.backgroundColor="pink"}const l=document.createElement("div");l.classList.add("entry-options");const d=document.createElement("button");d.innerHTML="X",d.classList.add("delete-button"),d.setAttribute("data-id",r),d.addEventListener("click",function(x){J(x,r)});const m=document.createElement("button");m.innerHTML="Edit",m.classList.add("entry-button"),m.setAttribute("data-id",r),m.addEventListener("click",function(x){Y(s,r)});const u=document.createElement("h4");u.textContent=C(s);const p=document.createElement("div");p.classList.add("card-diary");const g=document.createElement("p");g.textContent=`Weight: ${t}`;const h=document.createElement("p");h.textContent=`Sleep hours: ${i}`;const E=document.createElement("h");E.textContent="Notes";const v=document.createElement("div"),T=document.createElement("p");return v.classList.add("card-notes-section"),T.textContent=c,v.appendChild(T),l.appendChild(m),l.appendChild(d),a.appendChild(u),a.appendChild(l),p.appendChild(g),p.appendChild(h),p.appendChild(E),p.appendChild(v),o.appendChild(a),o.appendChild(p),o}async function J(e,o){let r=localStorage.getItem("token");const n=e.target.attributes["data-id"].value,t=document.getElementById(o),c="http://127.0.0.1:3000/api/entries/",i={entry_id:n};console.log(i);const s={method:"DELETE",headers:{Authorization:"Bearer: "+r,"Content-Type":"application/json"},body:JSON.stringify(i)};confirm("Oletko varma poistosta")&&b(c,s).then(l=>{t.innerHTML="",console.log(s),console.log(l),l.error?y("crimson","Couldn't delete entry!"):y("darkgreen","Entry deleted!")})}function Y(e,o){console.log("Edit painettu",e);const r=W(e,o),n=document.querySelector(".bottom-left-diary");n.innerHTML="",n.appendChild(r)}function W(e,o){const r=document.createElement("h3");r.innerHTML=`Currently modifying entry from: ${C(e)}`;const n=document.createElement("div");n.classList.add("container"),n.appendChild(r);const t=document.createElement("form");n.id="modify-entry-form",t.id="entry_form",t.setAttribute("method","post"),t.setAttribute("id","entry_form");const c=document.createElement("label");c.setAttribute("for","mood"),c.textContent="Update color",t.appendChild(c);const i=document.createElement("select");i.setAttribute("id","mood"),i.setAttribute("name","mood"),["Red","Orange","Yellow","Green"].forEach(function(h){const E=document.createElement("option");E.setAttribute("value",h),E.textContent=h,i.appendChild(E)}),t.appendChild(i);const s=document.createElement("label");s.setAttribute("for","weight"),s.textContent="Weight (kg):",t.appendChild(s);const a=document.createElement("input");a.setAttribute("type","number"),a.setAttribute("id","weight"),a.setAttribute("name","weight"),a.setAttribute("step","0.1"),a.setAttribute("placeholder","Enter your weight"),a.required=!0,t.appendChild(a);const l=document.createElement("label");l.setAttribute("for","sleep"),l.textContent="Sleep hours:",t.appendChild(l);const d=document.createElement("input");d.setAttribute("type","number"),d.setAttribute("id","sleep"),d.setAttribute("name","sleep"),d.setAttribute("step","0.1"),d.setAttribute("placeholder","Enter your sleep hours"),d.required=!0,t.appendChild(d);const m=document.createElement("label");m.setAttribute("for","notes"),m.textContent="Update description",t.appendChild(m);const u=document.createElement("textarea");u.setAttribute("id","notes"),u.setAttribute("name","notes"),u.setAttribute("rows","8"),u.setAttribute("placeholder","Enter additional notes"),u.style.resize="none",u.setAttribute("maxlength","250"),t.appendChild(u);const p=document.createElement("button");p.setAttribute("type","submit"),p.setAttribute("id","entry_submit"),p.textContent="Update diary entry",t.appendChild(p);const g=document.createElement("button");return g.setAttribute("type","button"),g.setAttribute("id","cancel"),g.textContent="Cancel",t.appendChild(g),t.addEventListener("submit",h=>{h.preventDefault(),G(e,o)}),g.addEventListener("click",h=>{h.preventDefault(),V()}),n.append(t),n}function G(e,o){const r=document.getElementById("mood").value,n=document.getElementById("weight").value,t=document.getElementById("sleep").value,c=document.getElementById("notes").value,i={entry_id:o,mood_color:r,weight:n,notes:c,sleep_hours:t,user_id:localStorage.getItem("user_id"),entry_date:e};console.log("update entry:",i),U(i),D()}function D(){const e=document.querySelector(".bottom-left-diary");e.innerHTML="";const o=document.createElement("div");o.className="container",o.id="diary-container";const r=document.createElement("h1");r.textContent="Create a diary entry",o.appendChild(r);const n=document.createElement("form");n.method="post",n.id="entry_form";let t=document.createElement("label");t.htmlFor="mood",t.textContent="Pick a color to represent your day: ",n.appendChild(t);const c=document.createElement("select");c.id="mood",c.name="mood",["Red","Orange","Yellow","Green"].forEach(l=>{const d=document.createElement("option");d.value=l,d.textContent=l,c.appendChild(d)}),n.appendChild(c),t=document.createElement("label"),t.htmlFor="weight",t.textContent="Weight (kg):",n.appendChild(t);let i=document.createElement("input");i.type="number",i.id="weight",i.name="weight",i.step="0.1",i.placeholder="Enter your weight",i.required=!0,n.appendChild(i),t=document.createElement("label"),t.htmlFor="sleep",t.textContent="Sleep hours:",n.appendChild(t),i=document.createElement("input"),i.type="number",i.id="sleep",i.name="sleep",i.step="0.1",i.placeholder="Enter your sleep hours",i.required=!0,n.appendChild(i),t=document.createElement("label"),t.htmlFor="notes",t.textContent="Describe your day:",n.appendChild(t);const s=document.createElement("textarea");s.id="notes",s.name="notes",s.rows="8",s.placeholder="Enter additional notes",s.style.resize="none",s.maxLength="250",n.appendChild(s);const a=document.createElement("button");a.type="submit",a.id="entry_submit",a.textContent="Create diary entry",n.appendChild(a),n.addEventListener("submit",l=>{l.preventDefault(),_(),w()}),o.appendChild(n),e.appendChild(o)}function A(e){const o=new Date(e);o.setDate(o.getDate());const r=o.getFullYear(),n=String(o.getMonth()+1).padStart(2,"0"),t=String(o.getDate()).padStart(2,"0");return`${r}-${n}-${t}`}function C(e){const o=new Date(e),r=new Date(o.getTime()+2*60*60*1e3),n=r.getDate(),t=r.getMonth()+1,c=r.getFullYear();return`${n<10?"0":""}${n}.${t<10?"0":""}${t}.${c}`}function k(){const e=new Date,o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${o}-${r}-${n}`}function R(){const e=document.querySelector(".right-diary");e.innerHTML="",f.style.display="None"}function X(){const e=document.querySelector(".exercise-stats-target");e.innerHTML=""}function K(){console.log("Pressed"),X(),document.querySelector(".tbody").innerHTML="",L.style.display="None"}function Q(){localStorage.removeItem("token"),localStorage.removeItem("user_id"),localStorage.removeItem("username"),window.location.href="home.html"}function V(){D()}
