import"./modulepreload-polyfill-B5Qt9EMX.js";import{f as h}from"./fetch-DJ5P6f8c.js";document.addEventListener("DOMContentLoaded",async()=>{try{const o="http://localhost:3000/api/auth/me",e={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}},t=await h(o,e);if(t.error==="invalid token"||t.user.user_level!=="admin")throw new Error("Unauthorized");document.getElementById("name").innerHTML=t.user.username}catch(o){console.error("Error:",o.message),window.location.href="index.html"}});const A=document.querySelector(".get_users");A.addEventListener("click",b);const x=document.querySelector("#hide_all_entries");x.addEventListener("click",F);const B=document.querySelector("#hide_all_users");B.addEventListener("click",w);const q=document.querySelector(".logo");q.addEventListener("click",S);const H=document.querySelector(".navigation a");H.addEventListener("click",S);const y=document.querySelector("dialog"),M=document.querySelector("dialog button");M.addEventListener("click",()=>{y.close()});async function b(){console.log("Fetching all users from server");let o=localStorage.getItem("token");const n="http://127.0.0.1:3000/api/users",e={method:"GET",headers:{Authorization:"Bearer: "+o}};h(n,e).then(t=>{G(t)})}async function U(o){const n=o.target.getAttribute("data-id");console.log(`Accessing all entries: user_id = ${n}`);const e=localStorage.getItem("token"),t=`http://127.0.0.1:3000/api/entries/${n}`,a={method:"GET",headers:{Authorization:"Bearer "+e}};h(t,a).then(r=>{r.error?(v(r.error),console.log(r)):(console.log("Entries found"),N(r))}).catch(r=>{console.error("Error fetching user data:",r),v(r)})}async function z(o){const n=o.target.getAttribute("data-id");console.log(`Accessing user info: user_id = ${n}`);const e=localStorage.getItem("token"),t=`http://127.0.0.1:3000/api/users/${n}`,a={method:"GET",headers:{Authorization:"Bearer "+e}};h(t,a).then(r=>{console.log(r)}).catch(r=>{console.error("Error fetching user data:",r)})}async function O(o){console.log("Deletoit tietoa"),console.log(o);const n=o.target.attributes["data-id"].value;console.log(n);const e=`http://127.0.0.1:3000/api/users/${n}`,a={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm(`Oletko varma ett채 haluat poistaa k채ytt채j채n ID: ${n} `)&&h(e,a).then(s=>{console.log(s),b()})}async function P(o,n){let e=localStorage.getItem("token");const t=o.target.attributes["data-id"].value,a=document.getElementById(n),r="http://127.0.0.1:3000/api/entries/",s={entry_date:j(t)};console.log(s);const m={method:"DELETE",headers:{Authorization:"Bearer: "+e,"Content-Type":"application/json"},body:JSON.stringify(s)};confirm("Oletko varma poistosta")&&h(r,m).then(u=>{a.innerHTML="",console.log(u),v(u.message)})}function G(o){const n=document.querySelector(".tbody");n.innerHTML="",o.forEach(e=>{const t=document.createElement("tr"),a=document.createElement("td"),r=document.createElement("td"),s=document.createElement("td"),m=document.createElement("td"),p=document.createElement("td"),u=document.createElement("td");a.innerText=e.username,r.innerText=e.user_level,p.innerText=e.user_id;const d=document.createElement("button");d.className="check",d.setAttribute("data-id",e.user_id),d.innerText="Info",s.appendChild(d),d.addEventListener("click",()=>{y.showModal(),y.querySelector("p").innerHTML=`
        <div>UserID: ${e.user_id}</div>
        <div>Username: ${e.username}</div>
        <div>Email: ${e.email}</div>
        <div>Role: ${e.user_level}</div> 
        <div>Created at: ${D(e.created_at)}</div>
        <div><br>${e.username} has ${e.diary_entry_count} entries</div>
        <div>${e.username} has ${e.monthly_average_count} monthly averages`});const i=document.createElement("button");i.className="del",i.setAttribute("data-id",e.user_id),i.innerText="Delete",m.appendChild(i);const c=document.createElement("button");c.className="check",c.setAttribute("data-id",e.user_id),c.innerText="Get all entries",u.appendChild(c),d.addEventListener("click",z),c.addEventListener("click",U),i.addEventListener("click",O),t.appendChild(a),t.appendChild(r),t.appendChild(s),t.appendChild(m),t.appendChild(p),t.appendChild(u),n.appendChild(t)})}function N(o){const n=document.querySelector("#entry_target");n.innerHTML="",o.forEach(e=>{const t=document.createElement("div");t.classList.add("card"),t.id=e.entry_id;const a=e.entry_id,r=e.user_id,s=e.mood_color,m=e.weight,p=e.notes,u=e.sleep_hours,d=e.entry_date,i=D(d),c=document.createElement("div");c.classList.add("mood-colour"),c.id="trigger",c.style.backgroundColor=s;const E=document.createElement("div");E.classList.add("entry-options");const g=document.createElement("button");g.innerHTML="Delete",g.classList.add("entry-button"),g.setAttribute("data-id",d),g.addEventListener("click",function(I){P(I,a)});const f=document.createElement("h4");f.textContent=i;const l=document.createElement("div");l.classList.add("card-diary");const C=document.createElement("p");C.textContent=`Entry id: ${a}`;const k=document.createElement("p");k.textContent=`User id: ${r}`;const L=document.createElement("p");L.textContent=`Weight: ${m}`;const T=document.createElement("p");T.textContent=`Created at: ${i}`;const _=document.createElement("p");_.textContent=`Notes: ${p}`;const $=document.createElement("p");$.textContent=`Sleep hours: ${u}`,E.appendChild(g),c.appendChild(f),c.appendChild(E),l.appendChild(C),l.appendChild(k),l.appendChild(L),l.appendChild(T),l.appendChild(_),l.appendChild($),t.appendChild(c),t.appendChild(l),n.appendChild(t)})}function D(o){const n=new Date(o),e=new Date(n.getTime()+2*60*60*1e3),t=e.getDate(),a=e.getMonth()+1,r=e.getFullYear();return`${t<10?"0":""}${t}.${a<10?"0":""}${a}.${r}`}function v(o){const n=document.getElementById("create-bad-login-snackbar");n.innerHTML=o,n.classList.contains("show")||(n.classList.add("show"),setTimeout(function(){n.classList.remove("show")},3e3))}function j(o){const[n,e,t]=o.split(".");return`${t}-${e.padStart(2,"0")}-${n.padStart(2,"0")}`}function F(){const o=document.querySelector("#entry_target");o.innerHTML=""}function w(){const o=document.querySelector(".tbody");o.innerHTML=""}function S(){localStorage.removeItem("token"),window.location.href="index.html"}
