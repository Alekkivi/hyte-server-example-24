import"./universal-styles-Dbk1WByh.js";import{f,g as v,a as F,c as w,d as $,b as U,e as _,h as j,l as T}from"./log-out-BDTD2EQk.js";import{f as q,g as x,s as u}from"./fetch-qW78LKou.js";async function I(e,n){const o={method:"POST",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(n)};return q(e,o)}async function B(e,n){const o={method:"PUT",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(n)};return q(e,o)}document.addEventListener("DOMContentLoaded",async()=>{try{const e=await x("/api/auth/me"),n=localStorage.getItem("token");if(e.error==="invalid token"||!n)throw new Error("Unauthorized");console.log("Page reload getMe",e),localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username),document.querySelector("#greeting-header").innerHTML=`Welcome back ${e.user.username}!`,document.querySelector("#date-header").innerHTML=f(v()),document.getElementById("notes").value=""}catch{window.location.href="index.html"}});const P=document.querySelector("#view-user-text-button");P.addEventListener("click",V);function V(){console.log("clicked");const e=localStorage.getItem("user_id");F(e)}const W=document.querySelector("#update-account-text-button");W.addEventListener("click",R);function R(){document.querySelector("#update-account-text-button").style.display="none";const e=document.querySelector("#update-user-form");e.style.display="block";const n=document.querySelector("#cancel-account-update-button");n.style.display="block",e.removeEventListener("submit",k),e.addEventListener("submit",k)}function k(e){if(e.preventDefault(),e.target.checkValidity())z();else{e.target.reportValidity();return}}function z(){const e=document.querySelector('input[name="updated-username"]').value,n=document.querySelector('input[name="updated-password"]').value,a=document.querySelector('input[name="updated-email"]').value;Y({username:e,password:n,email:a})}async function Y(e){const n=await B("/api/users",e);n.error?n.error==="Bad Request"?u("Crimson","Invalid username or email address"):u("crimson","Account could not be updated"):(u("darkgreen","Account information updated!"),localStorage.setItem("username",e.username),document.querySelector("#greeting-header").innerHTML=`Welcome back ${e.username}!`,G())}function G(){document.querySelector("#update-account-text-button").style.display="block",document.querySelector("#cancel-account-update-button").style.display="none";const e=document.querySelector("#update-user-form");e.style.display="none",e.reset()}const J=document.querySelector("#get_all_entries");J.addEventListener("click",D);async function D(){const e=await x("/api/entries");S.style.display="inline";const n=Object.keys(e).length;if(n===0)return u("crimson","No entries found");u("Darkgreen",`${n} entries found`);const a=document.querySelector(".right-diary");a.innerHTML="",e.forEach(o=>{a.appendChild(X(o))})}function X(e){const n=document.createElement("div");n.classList.add("card"),n.id=e.entry_id;const a=e.entry_id,o=e.mood_color,t=e.weight,l=e.notes,d=e.sleep_hours,s=w(e.entry_date),i=document.createElement("div");i.classList.add("mood-colour"),i.id="trigger",i.style.backgroundColor=o;const c=document.createElement("div");c.classList.add("entry-options");const r=document.createElement("button");r.innerHTML="X",r.classList.add("delete-button"),r.setAttribute("data-id",a),r.addEventListener("click",function(A){$(A,a)});const m=document.createElement("button");m.innerHTML="Edit",m.classList.add("entry-button"),m.setAttribute("data-id",a),m.addEventListener("click",function(A){K(s,a)});const h=document.createElement("h4");h.textContent=f(s);const y=document.createElement("div");y.classList.add("card-diary");const b=document.createElement("p");b.textContent=`Weight: ${t}`;const E=document.createElement("p");E.textContent=`Sleep hours: ${d}`;const p=document.createElement("h5");p.textContent="Notes";const g=document.createElement("div"),L=document.createElement("p");return g.classList.add("card-notes-section"),L.textContent=l,g.appendChild(L),c.appendChild(m),c.appendChild(r),i.appendChild(h),i.appendChild(c),y.appendChild(b),y.appendChild(E),y.appendChild(p),y.appendChild(g),n.appendChild(i),n.appendChild(y),n}function K(e,n){const a=Q(e,n),o=document.querySelector(".bottom-left-diary");o.innerHTML="",o.appendChild(a)}function Q(e,n){const a=document.createElement("h3");a.innerHTML=`Currently modifying entry from: ${f(e)}`;const o=document.createElement("div");o.classList.add("container"),o.appendChild(a);const t=document.createElement("form");o.id="modify-entry-form",t.id="entry_form",t.setAttribute("method","post"),t.setAttribute("id","entry_form");const l=document.createElement("label");l.setAttribute("for","mood"),l.textContent="Update color",t.appendChild(l);const d=document.createElement("select");d.setAttribute("id","mood"),d.setAttribute("name","mood"),["Select a color","Red","Orange","Yellow","Green"].forEach(E=>{let p=document.createElement("option");p.value=E,p.textContent=E,E==="Select a color"&&(p.disabled=!0,p.selected=!0,p.hidden=!0),d.appendChild(p)}),t.appendChild(d);const s=document.createElement("label");s.setAttribute("for","weight"),s.textContent="Weight (kg):",t.appendChild(s);const i=document.createElement("input");i.setAttribute("type","number"),i.setAttribute("id","weight"),i.setAttribute("name","weight"),i.setAttribute("step","0.1"),i.setAttribute("min","0.1"),i.setAttribute("max","635"),i.setAttribute("placeholder","Enter your weight"),i.required=!0,t.appendChild(i);const c=document.createElement("label");c.setAttribute("for","sleep"),c.textContent="Sleep hours:",t.appendChild(c);const r=document.createElement("input");r.setAttribute("type","number"),r.setAttribute("id","sleep"),r.setAttribute("name","sleep"),r.setAttribute("step","0.1"),r.setAttribute("min","0"),r.setAttribute("max","24"),r.setAttribute("placeholder","Enter your sleep hours"),r.required=!0,t.appendChild(r);const m=document.createElement("label");m.setAttribute("for","notes"),m.textContent="Update description",t.appendChild(m);const h=document.createElement("textarea");h.setAttribute("id","notes"),h.setAttribute("name","notes"),h.setAttribute("rows","8"),h.setAttribute("placeholder","Enter additional notes"),h.style.resize="none",h.setAttribute("maxlength","250"),t.appendChild(h);const y=document.createElement("button");y.setAttribute("type","submit"),y.setAttribute("id","entry_submit"),y.textContent="Update diary entry",t.appendChild(y);const b=document.createElement("button");return b.setAttribute("type","button"),b.setAttribute("id","cancel"),b.textContent="Cancel",t.appendChild(b),t.addEventListener("submit",E=>{if(E.preventDefault(),t.checkValidity())Z(e,n);else{t.reportValidity(),u("Crimson","Invalid input");return}}),b.addEventListener("click",E=>{E.preventDefault(),H()}),o.append(t),o}function Z(e,n){const a=document.getElementById("mood").value,o=document.getElementById("weight").value,t=document.getElementById("sleep").value,l=document.getElementById("notes").value;if(a==="Select a color"){u("Crimson","Please select a color to represent your mood");return}const d={entry_id:n,mood_color:a,weight:o,notes:l,sleep_hours:t,user_id:localStorage.getItem("user_id"),entry_date:e};console.log("update entry:",d),ee(d),H()}async function ee(e){(await B("/api/entries",e)).error?u("crimson","Couldn't update entry!"):(u("darkgreen","Entry updated!"),D())}function H(){const e=document.querySelector(".bottom-left-diary");e.innerHTML="";const n=document.createElement("div");n.className="container",n.id="diary-container";const a=document.createElement("h1");a.textContent="Create a diary entry",n.appendChild(a);const o=document.createElement("form");o.method="post",o.id="entry_form";let t=document.createElement("label");t.htmlFor="mood",t.textContent="Pick a color to represent your day: ",o.appendChild(t);const l=document.createElement("select");l.id="mood",l.name="mood",["Select a color","Red","Orange","Yellow","Green"].forEach(c=>{let r=document.createElement("option");r.value=c,r.textContent=c,c==="Select a color"&&(r.disabled=!0,r.selected=!0,r.hidden=!0,r.value="placeholder"),l.appendChild(r)}),o.appendChild(l),t=document.createElement("label"),t.htmlFor="weight",t.textContent="Weight (kg):",o.appendChild(t);let d=document.createElement("input");d.type="number",d.id="weight",d.name="weight",d.step="0.1",d.placeholder="Enter your weight",d.required=!0,o.appendChild(d),t=document.createElement("label"),t.htmlFor="sleep",t.textContent="Sleep hours:",o.appendChild(t),d=document.createElement("input"),d.type="number",d.id="sleep",d.name="sleep",d.step="0.1",d.placeholder="Enter your sleep hours",d.required=!0,o.appendChild(d),t=document.createElement("label"),t.htmlFor="notes",t.textContent="Describe your day:",o.appendChild(t);const s=document.createElement("textarea");s.id="notes",s.name="notes",s.rows="8",s.placeholder="Enter additional notes",s.style.resize="none",s.maxLength="250",o.appendChild(s);const i=document.createElement("button");i.type="submit",i.id="entry_submit",i.textContent="Create diary entry",o.appendChild(i),o.addEventListener("submit",c=>{c.preventDefault(),M()}),n.appendChild(o),e.appendChild(n)}const C=document.querySelector("#entry_form");C.addEventListener("submit",e=>{if(document.getElementById("mood").value,e.preventDefault(),C.checkValidity())M();else{C.reportValidity();return}});function M(){const e=document.getElementById("mood").value,n=document.getElementById("weight").value,a=document.getElementById("sleep").value,o=document.getElementById("notes").value;if(e==="placeholder"){u("Crimson","Please select a color to represent your mood");return}const t={mood_color:e,weight:n,notes:o,sleep_hours:a,user_id:localStorage.getItem("user_id"),entry_date:v()};te(t)}async function te(e){(await I("/api/entries",e)).error?u("crimson","New entry couldn't be added!"):u("darkgreen","New entry added!")}const S=document.querySelector("#hide_all_entries");S.style.display="none";S.addEventListener("click",U);const ne=document.querySelector("#get_all_exercises");ne.addEventListener("click",O);async function O(){const e=await x("/api/exercises");if(Object.keys(e).length>0){document.querySelector("#hide_all_exercises").style.display="inline",oe(e);const n=ae(e);ie(n)}else u("crimson","No exercises found"),_()}function oe(e){const n=document.querySelector(".tbody"),a=document.querySelector(".thead");n.innerHTML="",a.innerHTML="";const o=document.createElement("tr"),t=document.createElement("th");t.innerText="Activity";const l=document.createElement("th");l.innerText="Intensity";const d=document.createElement("th");d.innerText="Duration";const s=document.createElement("th");s.innerText="Entry Date";const i=document.createElement("th");o.appendChild(t),o.appendChild(l),o.appendChild(d),o.appendChild(s),o.appendChild(i),a.appendChild(o),e.forEach(c=>{const r=document.createElement("tr");r.id=`exercise_id=${c.exercise_id}`;const m=document.createElement("td"),h=document.createElement("td"),y=document.createElement("td"),b=document.createElement("td"),E=document.createElement("td");m.innerText=c.activity,h.innerText=c.intensity,y.innerText=c.duration+" min",b.innerText=f(w(c.entry_date));const p=document.createElement("button");p.className="del",p.setAttribute("data-id",c.exercise_id),p.innerText="Delete",E.appendChild(p),p.addEventListener("click",re),r.appendChild(m),r.appendChild(h),r.appendChild(y),r.appendChild(b),r.appendChild(E),n.appendChild(r)})}async function re(e){const a={exercise_id:e.target.attributes["data-id"].value};confirm("Oletko varma että haluat poistaa aktiviteetin?")&&((await j("/api/exercises",a)).error?u("crimson","Exercise couldn't be deleted"):(u("darkgreen","Exercise deleted"),O()))}function ae(e){const n={},a={},o={};e.forEach(i=>{const c=i.activity,r=i.duration,m=i.intensity;o.total?o.total+=r:o.total=r,n[c]?n[c]+=r:n[c]=r,a[m]?a[m]+=r:a[m]=r});const t=Object.entries(n),l=Object.entries(a);t.sort((i,c)=>c[1]-i[1]),l.sort((i,c)=>c[1]-i[1]);const d=Object.fromEntries(t),s=Object.fromEntries(l);return{sortedActivities:d,sortedIntensities:s,total:o}}function ie(e){const n=document.querySelector(".middle-exercise");n.innerHTML="";const a=document.createElement("div"),o=document.createElement("h4");o.innerText="Time spent on each exercise:",a.appendChild(o);let t=800;Object.entries(e.sortedActivities).forEach(([i,c])=>{let r=document.createElement("p");r.innerHTML=`<span>${i}:</span> ${c} minutes`,r.style.fontWeight=t,a.appendChild(r),t>600&&(t-=60)}),t=800;const l=document.createElement("h4");l.innerHTML="<br>Time spent by intensity:",a.appendChild(l),Object.entries(e.sortedIntensities).forEach(([i,c])=>{let r=document.createElement("p");r.innerHTML=`<span>${i}:</span> ${c} minutes`,r.style.fontWeight=t,a.appendChild(r),t>600&&(t-=60)});const d=e.total.total;let s=document.createElement("p");s.innerHTML=`<br>You have spent in total <span>${d} minutes</span> exercising! <br>Thats <span>${Math.round(d/24*100)/100} hours</span> in total`,s.style.fontWeight=600,a.appendChild(s),n.appendChild(a)}const de=document.querySelector("#exercise-form");de.addEventListener("submit",e=>{e.preventDefault();const n=document.getElementById("activity").value,a=document.getElementById("duration").value,o=document.getElementById("intensity").value,t={activity:n,duration:a,intensity:o,user_id:localStorage.getItem("user_id"),entry_date:v()};ce(t)});async function ce(e){(await I("/api/exercises",e)).error?u("crimson","New exercise couldn't be added!"):u("darkgreen","New exercise added!")}const N=document.querySelector("#hide_all_exercises");N.style.display="none";N.addEventListener("click",_);const se=document.querySelector("#log-out");se.addEventListener("click",T);const le=document.querySelector("#mobile-sign-out");le.addEventListener("click",T);
