import"./universal-styles-BdW0YgS1.js";import{f as w,g as x,s as p}from"./fetch-Ne0umvXK.js";import{f as g,g as S,c as T,d as N,a as F,b as $,e as U,l as q}from"./clear-element-functions-B9G0iXRV.js";async function I(e,t){const o={method:"PUT",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(t)};return w(e,o)}async function B(e,t){const o={method:"POST",headers:{Authorization:"Bearer: "+localStorage.getItem("token"),"Content-Type":"application/json"},body:JSON.stringify(t)};return w(e,o)}document.addEventListener("DOMContentLoaded",async()=>{try{const e=await x("/api/auth/me"),t=localStorage.getItem("token");if(e.error==="invalid token"||!t)throw new Error("Unauthorized");console.log("Page reload getMe",e),localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username),document.querySelector("#greeting-header").innerHTML=`Welcome back ${e.user.username}!`,document.querySelector("#date-header").innerHTML=g(S())}catch{window.location.href="index.html"}});const j=document.querySelector("#update-account-text-button");j.addEventListener("click",V);function V(){document.querySelector("#update-account-text-button").style.display="none";const e=document.querySelector("#update-user-form");e.style.display="block";const t=document.querySelector("#cancel-account-update-button");t.style.display="block",t.addEventListener("click",v),e.addEventListener("submit",a=>{if(a.preventDefault(),e.checkValidity())W(),v();else{e.reportValidity();return}})}function W(){const e=document.querySelector('input[name="updated-username"]').value,t=document.querySelector('input[name="updated-password"]').value,a=document.querySelector('input[name="updated-email"]').value,o={username:e,password:t,email:a};console.log(o),P(o)}async function P(e){const t=I("/api/users",e);t.error?p("crimson","Couldn't update account!"):(console.log("User information updated: ",t),p("darkgreen","Account information updated!"),localStorage.setItem("username",e.username),document.querySelector("#greeting-header").innerHTML=`Welcome back ${e.username}!`,v())}function v(){document.querySelector("#update-account-text-button").style.display="block",document.querySelector("#cancel-account-update-button").style.display="none";const e=document.querySelector("#update-user-form");e.style.display="none",e.reset()}const R=document.querySelector("#get_all_entries");R.addEventListener("click",L);async function L(){const e=await x("/api/entries");A.style.display="inline";const t=Object.keys(e).length;if(t===0)return p("crimson","No entries found");p("Darkgreen",`${t} entries found`);const a=document.querySelector(".right-diary");a.innerHTML="",e.forEach(o=>{a.appendChild(z(o))})}function z(e){const t=document.createElement("div");t.classList.add("card"),t.id=e.entry_id;const a=e.entry_id,o=e.mood_color,n=e.weight,l=e.notes,d=e.sleep_hours,s=T(e.entry_date),i=document.createElement("div");i.classList.add("mood-colour"),i.id="trigger",i.style.backgroundColor=o;const c=document.createElement("div");c.classList.add("entry-options");const r=document.createElement("button");r.innerHTML="X",r.classList.add("delete-button"),r.setAttribute("data-id",a),r.addEventListener("click",function(_){N(_,a)});const u=document.createElement("button");u.innerHTML="Edit",u.classList.add("entry-button"),u.setAttribute("data-id",a),u.addEventListener("click",function(_){Y(s,a)});const h=document.createElement("h4");h.textContent=g(s);const y=document.createElement("div");y.classList.add("card-diary");const b=document.createElement("p");b.textContent=`Weight: ${n}`;const E=document.createElement("p");E.textContent=`Sleep hours: ${d}`;const m=document.createElement("h");m.textContent="Notes";const f=document.createElement("div"),k=document.createElement("p");return f.classList.add("card-notes-section"),k.textContent=l,f.appendChild(k),c.appendChild(u),c.appendChild(r),i.appendChild(h),i.appendChild(c),y.appendChild(b),y.appendChild(E),y.appendChild(m),y.appendChild(f),t.appendChild(i),t.appendChild(y),t}function Y(e,t){const a=G(e,t),o=document.querySelector(".bottom-left-diary");o.innerHTML="",o.appendChild(a)}function G(e,t){const a=document.createElement("h3");a.innerHTML=`Currently modifying entry from: ${g(e)}`;const o=document.createElement("div");o.classList.add("container"),o.appendChild(a);const n=document.createElement("form");o.id="modify-entry-form",n.id="entry_form",n.setAttribute("method","post"),n.setAttribute("id","entry_form");const l=document.createElement("label");l.setAttribute("for","mood"),l.textContent="Update color",n.appendChild(l);const d=document.createElement("select");d.setAttribute("id","mood"),d.setAttribute("name","mood"),["Select a color","Red","Orange","Yellow","Green"].forEach(E=>{let m=document.createElement("option");m.value=E,m.textContent=E,E==="Select a color"&&(m.disabled=!0,m.selected=!0,m.hidden=!0),d.appendChild(m)}),n.appendChild(d);const s=document.createElement("label");s.setAttribute("for","weight"),s.textContent="Weight (kg):",n.appendChild(s);const i=document.createElement("input");i.setAttribute("type","number"),i.setAttribute("id","weight"),i.setAttribute("name","weight"),i.setAttribute("step","0.1"),i.setAttribute("min","0.1"),i.setAttribute("max","635"),i.setAttribute("placeholder","Enter your weight"),i.required=!0,n.appendChild(i);const c=document.createElement("label");c.setAttribute("for","sleep"),c.textContent="Sleep hours:",n.appendChild(c);const r=document.createElement("input");r.setAttribute("type","number"),r.setAttribute("id","sleep"),r.setAttribute("name","sleep"),r.setAttribute("step","0.1"),r.setAttribute("min","0"),r.setAttribute("max","24"),r.setAttribute("placeholder","Enter your sleep hours"),r.required=!0,n.appendChild(r);const u=document.createElement("label");u.setAttribute("for","notes"),u.textContent="Update description",n.appendChild(u);const h=document.createElement("textarea");h.setAttribute("id","notes"),h.setAttribute("name","notes"),h.setAttribute("rows","8"),h.setAttribute("placeholder","Enter additional notes"),h.style.resize="none",h.setAttribute("maxlength","250"),n.appendChild(h);const y=document.createElement("button");y.setAttribute("type","submit"),y.setAttribute("id","entry_submit"),y.textContent="Update diary entry",n.appendChild(y);const b=document.createElement("button");return b.setAttribute("type","button"),b.setAttribute("id","cancel"),b.textContent="Cancel",n.appendChild(b),n.addEventListener("submit",E=>{if(E.preventDefault(),n.checkValidity())J(e,t);else{n.reportValidity(),p("Crimson","Invalid input");return}}),b.addEventListener("click",E=>{E.preventDefault(),D()}),o.append(n),o}function J(e,t){const a=document.getElementById("mood").value,o=document.getElementById("weight").value,n=document.getElementById("sleep").value,l=document.getElementById("notes").value,d={entry_id:t,mood_color:a,weight:o,notes:l,sleep_hours:n,user_id:localStorage.getItem("user_id"),entry_date:e};console.log("update entry:",d),X(d),D()}async function X(e){(await I("/api/entries",e)).error?p("crimson","Couldn't update entry!"):(p("darkgreen","Entry updated!"),L())}function D(){const e=document.querySelector(".bottom-left-diary");e.innerHTML="";const t=document.createElement("div");t.className="container",t.id="diary-container";const a=document.createElement("h1");a.textContent="Create a diary entry",t.appendChild(a);const o=document.createElement("form");o.method="post",o.id="entry_form";let n=document.createElement("label");n.htmlFor="mood",n.textContent="Pick a color to represent your day: ",o.appendChild(n);const l=document.createElement("select");l.id="mood",l.name="mood",["Select a color","Red","Orange","Yellow","Green"].forEach(c=>{let r=document.createElement("option");r.value=c,r.textContent=c,c==="Select a color"&&(r.disabled=!0,r.selected=!0,r.hidden=!0),l.appendChild(r)}),o.appendChild(l),n=document.createElement("label"),n.htmlFor="weight",n.textContent="Weight (kg):",o.appendChild(n);let d=document.createElement("input");d.type="number",d.id="weight",d.name="weight",d.step="0.1",d.placeholder="Enter your weight",d.required=!0,o.appendChild(d),n=document.createElement("label"),n.htmlFor="sleep",n.textContent="Sleep hours:",o.appendChild(n),d=document.createElement("input"),d.type="number",d.id="sleep",d.name="sleep",d.step="0.1",d.placeholder="Enter your sleep hours",d.required=!0,o.appendChild(d),n=document.createElement("label"),n.htmlFor="notes",n.textContent="Describe your day:",o.appendChild(n);const s=document.createElement("textarea");s.id="notes",s.name="notes",s.rows="8",s.placeholder="Enter additional notes",s.style.resize="none",s.maxLength="250",o.appendChild(s);const i=document.createElement("button");i.type="submit",i.id="entry_submit",i.textContent="Create diary entry",o.appendChild(i),o.addEventListener("submit",c=>{c.preventDefault(),H(),L()}),t.appendChild(o),e.appendChild(t)}const C=document.querySelector("#entry_form");C.addEventListener("submit",e=>{const t=document.getElementById("mood").value;if(e.preventDefault(),C.checkValidity())if(t==="placeholder"){p("Crimson","Please select a color to represent your mood");return}else H();else{C.reportValidity();return}});function H(){const e=document.getElementById("mood").value,t=document.getElementById("weight").value,a=document.getElementById("sleep").value,o=document.getElementById("notes").value,n={mood_color:e,weight:t,notes:o,sleep_hours:a,user_id:localStorage.getItem("user_id"),entry_date:S()};K(n)}async function K(e){(await B("/api/entries",e)).error?p("crimson","New entry couldn't be added!"):p("darkgreen","New entry added!")}const A=document.querySelector("#hide_all_entries");A.style.display="none";A.addEventListener("click",F);const Q=document.querySelector("#get_all_exercises");Q.addEventListener("click",M);async function M(){const e=await x("/api/exercises");if(Object.keys(e).length>0){document.querySelector("#hide_all_exercises").style.display="inline",Z(e);const t=te(e);ne(t)}else p("crimson","No exercises found")}function Z(e){const t=document.querySelector(".tbody"),a=document.querySelector(".thead");t.innerHTML="",a.innerHTML="";const o=document.createElement("tr"),n=document.createElement("th");n.innerText="Activity";const l=document.createElement("th");l.innerText="Intensity";const d=document.createElement("th");d.innerText="Duration";const s=document.createElement("th");s.innerText="Entry Date";const i=document.createElement("th");o.appendChild(n),o.appendChild(l),o.appendChild(d),o.appendChild(s),o.appendChild(i),a.appendChild(o),e.forEach(c=>{const r=document.createElement("tr");r.id=`exercise_id=${c.exercise_id}`;const u=document.createElement("td"),h=document.createElement("td"),y=document.createElement("td"),b=document.createElement("td"),E=document.createElement("td");u.innerText=c.activity,h.innerText=c.intensity,y.innerText=c.duration+" min",b.innerText=g(T(c.entry_date));const m=document.createElement("button");m.className="del",m.setAttribute("data-id",c.exercise_id),m.innerText="Delete",E.appendChild(m),m.addEventListener("click",ee),r.appendChild(u),r.appendChild(h),r.appendChild(y),r.appendChild(b),r.appendChild(E),t.appendChild(r)})}async function ee(e){const a={exercise_id:e.target.attributes["data-id"].value};confirm("Oletko varma että haluat poistaa aktiviteetin?")&&((await $("/api/exercises",a)).error?p("Crimson","Exercise couldn't be deleted"):(p("darkgreen","Exercise deleted"),M()))}function te(e){const t={},a={},o={};e.forEach(i=>{const c=i.activity,r=i.duration,u=i.intensity;o.total?o.total+=r:o.total=r,t[c]?t[c]+=r:t[c]=r,a[u]?a[u]+=r:a[u]=r});const n=Object.entries(t),l=Object.entries(a);n.sort((i,c)=>c[1]-i[1]),l.sort((i,c)=>c[1]-i[1]);const d=Object.fromEntries(n),s=Object.fromEntries(l);return{sortedActivities:d,sortedIntensities:s,total:o}}function ne(e){const t=document.querySelector(".middle-exercise");t.innerHTML="";const a=document.createElement("div"),o=document.createElement("h4");o.innerText="Time spent on each exercise:",a.appendChild(o);let n=800;Object.entries(e.sortedActivities).forEach(([i,c])=>{let r=document.createElement("p");r.innerHTML=`<span>${i}:</span> ${c} minutes`,r.style.fontWeight=n,a.appendChild(r),n>600&&(n-=60)}),n=800;const l=document.createElement("h4");l.innerHTML="<br>Time spent by intensity:",a.appendChild(l),Object.entries(e.sortedIntensities).forEach(([i,c])=>{let r=document.createElement("p");r.innerHTML=`<span>${i}:</span> ${c} minutes`,r.style.fontWeight=n,a.appendChild(r),n>600&&(n-=60)});const d=e.total.total;let s=document.createElement("p");s.innerHTML=`<br>You have spent in total <span>${d} minutes</span> exercising! <br>Thats <span>${Math.round(d/24*100)/100} hours</span> in total`,s.style.fontWeight=600,a.appendChild(s),t.appendChild(a)}const oe=document.querySelector("#exercise-form");oe.addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("activity").value,a=document.getElementById("duration").value,o=document.getElementById("intensity").value,n={activity:t,duration:a,intensity:o,user_id:localStorage.getItem("user_id"),entry_date:S()};re(n)});async function re(e){(await B("/api/exercises",e)).error?p("crimson","New exercise couldn't be added!"):p("darkgreen","New exercise added!")}const O=document.querySelector("#hide_all_exercises");O.style.display="none";O.addEventListener("click",U);const ae=document.querySelector("#log-out");ae.addEventListener("click",q);const ie=document.querySelector("#mobile-sign-out");ie.addEventListener("click",q);
