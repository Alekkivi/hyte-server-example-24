import"./universal-styles-BdW0YgS1.js";import{g as y,s as u}from"./fetch-Ne0umvXK.js";import{h as b,i as T,l as S,f as I,c as _,b as f,d as x}from"./clear-element-functions-B9G0iXRV.js";document.addEventListener("DOMContentLoaded",async()=>{try{const e=await y("/api/auth/me"),t=localStorage.getItem("token");if(e.error==="invalid token"||e.user.user_level!=="admin"||!t)throw new Error("Unauthorized");document.getElementById("name").innerHTML=e.user.username,localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username)}catch{window.location.href="index.html"}});const $=document.querySelector(".get_users");$.addEventListener("click",k);const v=document.querySelector("#hide_all_entries");v.addEventListener("click",b);v.style.display="none";const L=document.querySelector("#hide_all_users");L.addEventListener("click",T);L.style.display="none";const U=document.querySelector(".navigation a");U.addEventListener("click",S);async function k(){console.log("Fetching all users from server");const e=await y("/api/users");Object.keys(e).length,e.error?u("Crimson",e.message):(document.querySelector("#hide_all_users").style.display="inline",M(e))}async function w(e){const t=e.target.getAttribute("data-id");console.log(`Accessing all entries with user_id=${t}`),document.querySelector("#entry_target").innerHTML="";const n=await y(`/api/entries/${t}`);n.error?u("darkgray",`No entries found with User ID = ${t}`):(console.log("getUserEntries",n),H(n))}async function q(e){const t=e.target.getAttribute("data-id");console.log(`Accessing user info: user_id = ${t}`);const n=await y(`/api/users/${t}`);n.error?u("crimson",n.message):A(n)}function A(e){const t=document.querySelector("dialog"),n=document.getElementById("modal_target");n.innerHTML="";for(let s in e){let a=e[s];if(s==="Username"){let d=document.createElement("h3");d.innerText=a,n.appendChild(d)}else if(s==="Created at"){let d=document.createElement("p");d.innerHTML=`<span>${s}:</span> ${I(_(a))}`,n.appendChild(d)}else{let d=document.createElement("p");d.innerHTML=`<span>${s}:</span> ${a}`,n.appendChild(d)}}t.appendChild(n);let r=document.createElement("button");r.textContent="Close",n.appendChild(r),r.addEventListener("click",()=>{t.close()}),t.showModal()}async function D(e){const t=e.target.attributes["data-id"].value,n=localStorage.getItem("user_id");if(t==n){u("crimson","You cant delete your own account");return}else if(confirm(`Oletko varma ett채 haluat poistaa k채ytt채j채n ID: ${t} `)){let s=localStorage.getItem("token");f(`/api/exercises/${t}`,s),f(`/api/entries/${t}`,s);const a=f(`/api/users/${t}`,s);a.error?u("crimson",a.message):k()}}function M(e){const t=document.querySelector(".styled-table"),n=t.querySelector("thead"),r=t.querySelector("tbody");n.innerHTML="",r.innerHTML="";const s=document.createElement("tr");["User Name","User Level","Info","Delete","User ID","Entries"].forEach(d=>{const o=document.createElement("th");o.textContent=d,s.appendChild(o)}),n.appendChild(s),e.forEach(d=>{const o=document.createElement("tr"),m=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),E=document.createElement("td"),g=document.createElement("td"),C=document.createElement("td");m.innerText=d.username,p.innerText=d.user_level,g.innerText=d.user_id;const c=document.createElement("button");c.className="check",c.setAttribute("data-id",d.user_id),c.innerText="Info",h.appendChild(c);const i=document.createElement("button");i.className="del",i.setAttribute("data-id",d.user_id),i.innerText="Delete",E.appendChild(i);const l=document.createElement("button");l.className="check",l.setAttribute("data-id",d.user_id),l.innerText="Get all entries",C.appendChild(l),c.addEventListener("click",q),l.addEventListener("click",w),i.addEventListener("click",D),o.appendChild(m),o.appendChild(p),o.appendChild(h),o.appendChild(E),o.appendChild(g),o.appendChild(C),r.appendChild(o)})}async function H(e){const t=Object.keys(e).length;if(t===0){u("crimson","No entries found");return}else{u("darkgreen",`${t} entries found`),document.querySelector("#hide_all_entries").style.display="inline";const n=document.querySelector("#entry_target");n.innerHTML="",e.forEach(r=>{n.appendChild(B(r))})}}function B(e){const t=document.createElement("div");t.classList.add("card"),t.id=e.entry_id;const n=e.entry_id,r=document.createElement("div");r.classList.add("mood-colour"),r.id="trigger",r.style.backgroundColor=e.mood_color;const s=document.createElement("div");s.classList.add("entry-options");const a=document.createElement("button");a.innerHTML="X",a.classList.add("delete-button"),a.setAttribute("data-id",n),a.addEventListener("click",function(l){x(l,n)});const d=document.createElement("h4");d.textContent=_(e.entry_date);const o=document.createElement("div");o.classList.add("card-diary");const m=document.createElement("p");m.textContent=`User ID: ${e.user_id}`;const p=document.createElement("p");p.textContent=`Entry ID: ${e.entry_id}`;const h=document.createElement("p");h.textContent=`Created at: ${_(e.entry_date)}`;const E=document.createElement("p");E.textContent=`Weight: ${e.weight}`;const g=document.createElement("p");g.textContent=`Sleep hours: ${e.sleep_hours}`;const C=document.createElement("h5");C.textContent="Notes";const c=document.createElement("div"),i=document.createElement("p");return c.classList.add("card-notes-section"),i.textContent=e.notes,c.appendChild(i),s.appendChild(a),r.appendChild(d),r.appendChild(s),o.appendChild(m),o.appendChild(p),o.appendChild(h),o.appendChild(E),o.appendChild(g),o.appendChild(C),o.appendChild(c),t.appendChild(r),t.appendChild(o),t}
