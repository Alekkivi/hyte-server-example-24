import"./universal-styles-C-OwvYAL.js";import{i as b,j as k,l as T,k as I,h as g,d as w,c as _}from"./log-out-BDTD2EQk.js";import{g as f,s as l}from"./fetch-qW78LKou.js";document.addEventListener("DOMContentLoaded",async()=>{try{const e=await f("/api/auth/me"),t=localStorage.getItem("token");if(e.error==="invalid token"||e.user.user_level!=="admin"||!t)throw new Error("Unauthorized");document.getElementById("name").innerHTML=e.user.username,localStorage.setItem("user_id",e.user.user_id),localStorage.setItem("username",e.user.username)}catch{window.location.href="index.html"}});const x=document.querySelector(".get_users");x.addEventListener("click",S);const v=document.querySelector("#hide_all_entries");v.addEventListener("click",b);v.style.display="none";const L=document.querySelector("#hide_all_users");L.addEventListener("click",k);L.style.display="none";const U=document.querySelector(".navigation a");U.addEventListener("click",T);async function S(){const e=await f("/api/users");Object.keys(e).length>0?e.error?l("Crimson",e.message):(document.querySelector("#hide_all_users").style.display="inline",$(e)):l("Crimson","No users found")}async function q(e){const t=e.target.getAttribute("data-id");document.querySelector("#entry_target").innerHTML="";const r=await f(`/api/entries/${t}`);r.error?l("crimson",`No entries found with User ID = ${t}`):(console.log("getUserEntries",r),A(r))}async function D(e){const t=e.target.attributes["data-id"].value,r=localStorage.getItem("user_id");if(t==r){l("crimson","You cant delete your own account");return}else if(confirm(`Are you sure that you want to delete everything with User ID = ${t} ?`)){let d=await g(`/api/exercises/${t}`);d&&(d=await g(`/api/entries/${t}`)),d&&(d=await g(`/api/users/${t}`)),d.error?l("crimson","Something went wrong - Please try again"):(l("Darkgreen","User deleted"),document.querySelector("#entry_target").innerHTML="",S())}}function $(e){const t=document.querySelector(".styled-table"),r=t.querySelector("thead"),s=t.querySelector("tbody");r.innerHTML="",s.innerHTML="";const d=document.createElement("tr");["User Name","User Level","Info","Delete","User ID","Entries"].forEach(o=>{const n=document.createElement("th");n.textContent=o,d.appendChild(n)}),r.appendChild(d),e.forEach(o=>{const n=document.createElement("tr"),m=document.createElement("td"),p=document.createElement("td"),h=document.createElement("td"),E=document.createElement("td"),C=document.createElement("td"),y=document.createElement("td");m.innerText=o.username,p.innerText=o.user_level,C.innerText=o.user_id;const a=document.createElement("button");a.className="check",a.setAttribute("data-id",o.user_id),a.innerText="Info",h.appendChild(a);const c=document.createElement("button");c.className="del",c.setAttribute("data-id",o.user_id),c.innerText="Delete",E.appendChild(c);const i=document.createElement("button");i.className="check",i.setAttribute("data-id",o.user_id),i.innerText="Get all entries",y.appendChild(i),a.addEventListener("click",I),i.addEventListener("click",q),c.addEventListener("click",D),n.appendChild(m),n.appendChild(p),n.appendChild(h),n.appendChild(E),n.appendChild(C),n.appendChild(y),s.appendChild(n)})}async function A(e){l("darkgreen",`${Object.keys(e).length} entries found`),document.querySelector("#hide_all_entries").style.display="inline";const t=document.querySelector("#entry_target");t.innerHTML="",e.forEach(r=>{t.appendChild(H(r))})}function H(e){const t=document.createElement("div");t.classList.add("card"),t.id=e.entry_id;const r=e.entry_id,s=document.createElement("div");s.classList.add("mood-colour"),s.id="trigger",s.style.backgroundColor=e.mood_color;const d=document.createElement("div");d.classList.add("entry-options");const u=document.createElement("button");u.innerHTML="X",u.classList.add("delete-button"),u.setAttribute("data-id",r),u.addEventListener("click",function(i){w(i,r)});const o=document.createElement("h4");o.textContent=_(e.entry_date);const n=document.createElement("div");n.classList.add("card-diary");const m=document.createElement("p");m.textContent=`User ID: ${e.user_id}`;const p=document.createElement("p");p.textContent=`Entry ID: ${e.entry_id}`;const h=document.createElement("p");h.textContent=`Created at: ${_(e.entry_date)}`;const E=document.createElement("p");E.textContent=`Weight: ${e.weight}`;const C=document.createElement("p");C.textContent=`Sleep hours: ${e.sleep_hours}`;const y=document.createElement("h5");y.textContent="Notes";const a=document.createElement("div"),c=document.createElement("p");return a.classList.add("card-notes-section"),c.textContent=e.notes,a.appendChild(c),d.appendChild(u),s.appendChild(o),s.appendChild(d),n.appendChild(m),n.appendChild(p),n.appendChild(h),n.appendChild(E),n.appendChild(C),n.appendChild(y),n.appendChild(a),t.appendChild(s),t.appendChild(n),t}
